# knot trackball ビルドガイド

## BOM を確認する

ケース、トラックボールホルダー、メイン基板、スイッチ基板は仮組みした状態になっています。  
ねじを外して分解してから組み立ててください。  
ボールホルダーのベアリング部は分解する必要はありません。

## 組み立て

1. スイッチ基板のはんだづけ
   ![switch](imgs/P3163935.jpg)
   ![switch](imgs/P3163937.jpg)

   スイッチ基板とスイッチをはんだづけします。
   プレートを通すのを忘れずに。

2. メイン基板のはんだづけ
   ![main](imgs/P3163936.jpg)

   メイン基板に、Xiao nrf52840 と電源スイッチ、マウスセンサーをはんだづけします
   マウスセンサーの向きに注意してください

3. マウスセンサーのレンズとトラックボールホルダー、ボトムケースをとりつける
   ![lens&holder](imgs/P3163938.jpg)
   ![lens&holder&bottom](imgs/P3163940.jpg)

   マウスセンサーについている保護シールを剥がしてレンズを取り付けます。
   そのあと、トラックボールホルダーとメイン基板、ボトムケースをねじ止めします。

4. フラットケーブルで基板を接続する
   ![ffc](imgs/P3163939.jpg)
   ![ffc](imgs/P3163942.jpg)

   フラットケーブルでメイン・スイッチ基板間を接続します。  
   フラットケーブルに向きはありませんが、ねじったりしないように気をつけてください。(基板上の ● があうように差し込んでください)
   **フラットケーブルコネクタは壊れやすいです**  
   留め具の開閉は十分注意してください。  
   また、フラットケーブルを接続した後は無理に引っ張ったりしないよう取り扱いに注意して動作確認をしてください。

## 動作確認

1. 電源がショートしていないか確認する
   xiao の電源ピンにテスターをあててショートしていないことを確認します。  
   VBUS-GND、3.3V-GND 間のどちらも確認してください
2. テスト用ファームウェアを書き込む
   マウスとキーボード(1・2・3・4 が入力される)操作をテストするためのファームウェアを用意しています。  
   xiao を書き込みモードにするためには、Reset ボタンを 2 回連続で押してください。  
   USB ストレージとして認識されるのでそこへファームウェアのファイルを書き込んでください。
   (TODO) ファームウェアの準備

## ケースの組み立て

1. メイン基板側のフラットケーブルを抜く
2. メイン基板とボトムケース、MCU カバーをねじ止めする
   ![mcu cover](imgs/P3163943.jpg)

   メイン基板に MCU カバーを被せて、ボトムケースの上にのせ、ネジでとめます。  
   **！ネジは全て締めすぎないように！**

3. スイッチ基板とトップケースをねじ止めする
   1. スイッチ基板のプレートの穴からネジを差し込みます  
      ![switch&screw](imgs/P3163944.jpg)  
      ドライバーで軽く押し込んで奥まで入ったことを確認してください
   2. フラットケーブルをトップケースの穴に通します
      ![switch&top](imgs/P3163945.jpg)
   3. スイッチ基板をネジ止めします  
      印刷精度の都合で空回りしてしまう場合があります。その場合は他のネジを慎重に締めてください。2 つ程度締まれば問題ありません。
4. メイン基板にフラットケーブルを差し込む
   ![ffc](imgs/P3163946.jpg)

5. メインケースとボトムケースをねじ止めする  
   **フラットケーブルの扱いに注意**  
   フラットケーブルはうまく折りたたんで収納してください。  
   ケースに挟まない・ボールやベアリングに当たらない場所を探しくてください。

6. トラックボールホルダーの位置を調整する
   ![adjust holder](imgs/P3163950.jpg)

   ボールを乗せてトップケースと中心があっているか確認してください  
   ズレている場合はボールを取り外してボールホルダーのネジを全て緩めて調整してください  
   中心になったあと、もう一度ネジをしっかりしめます

7. ファームウェアを書き込む  
   メイン基板上のリセットスイッチはケース底面からアクセスできます

8. ゴム足をつける

## ファームウェアについて

https://github.com/hsgw/zmk-config-knot
